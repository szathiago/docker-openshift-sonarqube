{"version":3,"sources":["webpack:///./src/main/js/apps/maintenance/components/MaintenanceAppContainer.tsx","webpack:///./src/main/js/components/intl/DateFromNow.tsx","webpack:///./src/main/js/api/system.ts","webpack:///./src/main/js/components/intl/TimeFormatter.tsx","webpack:///./src/main/js/apps/maintenance/styles.css","webpack:///./src/main/js/apps/maintenance/styles.css?c19d","webpack:///./src/main/js/apps/maintenance/components/App.tsx"],"names":["MaintenanceAppContainer","props","react__WEBPACK_IMPORTED_MODULE_0__","_App__WEBPACK_IMPORTED_MODULE_1__","__assign","setup","DateFromNow","_a","children","date","react_intl__WEBPACK_IMPORTED_MODULE_1__","value","Object","_helpers_dates__WEBPACK_IMPORTED_MODULE_2__","HealthType","setLogLevel","level","_helpers_request__WEBPACK_IMPORTED_MODULE_0__","catch","_app_utils_throwGlobalError__WEBPACK_IMPORTED_MODULE_1__","getSystemInfo","getSystemStatus","getSystemUpgrades","getMigrationStatus","migrateDatabase","POLLING_INTERVAL","promiseStatus","Promise","resolve","pollStatus","cb","setTimeout","then","r","status","restartAndWait","formatterOption","hour","minute","longFormatterOption","second","TimeFormatter","long","module","exports","__webpack_require__","push","i","content","options","hmr","transform","insertInto","undefined","locals","App","_super","_this","apply","this","arguments","mounted","state","fetchStatus","fetchMigrationState","fetchSystemStatus","setState","message","startedAt","_api_system__WEBPACK_IMPORTED_MODULE_3__","wasStarting","scheduleRefresh","loadPreviousPage","interval","window","setInterval","location","href","query","_helpers_urls__WEBPACK_IMPORTED_MODULE_8__","handleMigrateClick","__extends","prototype","componentDidMount","componentWillUnmount","clearInterval","render","react_helmet__WEBPACK_IMPORTED_MODULE_2___default","a","defaultTitle","_helpers_l10n__WEBPACK_IMPORTED_MODULE_7__","className","id","classnames__WEBPACK_IMPORTED_MODULE_1__","panel-warning","dangerouslySetInnerHTML","__html","_components_ui_buttons__WEBPACK_IMPORTED_MODULE_6__","onClick","_components_intl_DateFromNow__WEBPACK_IMPORTED_MODULE_4__","_components_intl_TimeFormatter__WEBPACK_IMPORTED_MODULE_5__"],"mappings":"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","file":"js/281.8234b7f6.chunk.js","sourcesContent":["/*\n * SonarQube\n * Copyright (C) 2009-2018 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport App from './App';\n\ninterface Props {\n  // eslint-disable-next-line camelcase\n  location: { query: { return_to: string } };\n}\n\nexport default function MaintenanceAppContainer(props: Props) {\n  return <App setup={false} {...props} />;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2018 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { DateSource, FormattedRelative } from 'react-intl';\nimport { parseDate } from '../../helpers/dates';\n\ninterface Props {\n  children?: (formattedDate: string) => React.ReactNode;\n  date: DateSource;\n}\n\nexport default function DateFromNow({ children, date }: Props) {\n  return <FormattedRelative value={parseDate(date)}>{children}</FormattedRelative>;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2018 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { getJSON, post, postJSON } from '../helpers/request';\nimport throwGlobalError from '../app/utils/throwGlobalError';\n\nexport type SysValue = boolean | string | number | HealthType | SysValueObject | SysValueArray;\nexport interface SysValueObject {\n  [key: string]: SysValue;\n}\nexport interface SysValueArray extends Array<SysValue> {}\n\nexport interface SysInfoSection {\n  [sectionName: string]: SysValueObject;\n}\n\nexport enum HealthType {\n  RED = 'RED',\n  YELLOW = 'YELLOW',\n  GREEN = 'GREEN'\n}\n\nexport interface NodeInfo extends SysValueObject {\n  'Compute Engine Logging': { 'Logs Level': string };\n  Health: HealthType;\n  'Health Causes': string[];\n  Name: string;\n  'Web Logging': { 'Logs Level': string };\n}\n\nexport interface SysInfo extends SysValueObject {\n  Health: HealthType;\n  'Health Causes': string[];\n  System: {\n    'High Availability': boolean;\n    'Logs Level': string;\n    'Server ID': string;\n  };\n}\n\nexport interface ClusterSysInfo extends SysInfo {\n  'Application Nodes': NodeInfo[];\n  'Search Nodes': NodeInfo[];\n}\n\nexport interface SystemUpgrade {\n  version: string;\n  description: string;\n  releaseDate: string;\n  changeLogUrl: string;\n  downloadUrl: string;\n  plugins: any;\n}\n\nexport function setLogLevel(level: string): Promise<void | Response> {\n  return post('/api/system/change_log_level', { level }).catch(throwGlobalError);\n}\n\nexport function getSystemInfo(): Promise<SysInfo> {\n  return getJSON('/api/system/info').catch(throwGlobalError);\n}\n\nexport function getSystemStatus(): Promise<{ id: string; version: string; status: string }> {\n  return getJSON('/api/system/status');\n}\n\nexport function getSystemUpgrades(): Promise<{\n  upgrades: SystemUpgrade[];\n  updateCenterRefresh: string;\n}> {\n  return getJSON('/api/system/upgrades');\n}\n\nexport function getMigrationStatus(): Promise<{\n  message?: string;\n  startedAt?: string;\n  state: string;\n}> {\n  return getJSON('/api/system/db_migration_status');\n}\n\nexport function migrateDatabase(): Promise<{\n  message?: string;\n  startedAt?: string;\n  state: string;\n}> {\n  return postJSON('/api/system/migrate_db');\n}\n\nexport function restart(): Promise<void | Response> {\n  return post('/api/system/restart').catch(throwGlobalError);\n}\n\nconst POLLING_INTERVAL = 2000;\n\nfunction pollStatus(cb: Function): void {\n  setTimeout(() => {\n    getSystemStatus()\n      .then(r => {\n        if (r.status === 'UP') {\n          cb();\n        } else {\n          pollStatus(cb);\n        }\n      })\n      .catch(() => pollStatus(cb));\n  }, POLLING_INTERVAL);\n}\n\nfunction promiseStatus(): Promise<any> {\n  return new Promise(resolve => pollStatus(resolve));\n}\n\nexport function restartAndWait(): Promise<any> {\n  return restart().then(promiseStatus);\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2018 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { DateSource, FormattedTime } from 'react-intl';\nimport { parseDate } from '../../helpers/dates';\n\ninterface Props {\n  children?: (formattedDate: string) => React.ReactNode;\n  date: DateSource;\n  long?: boolean;\n}\n\nexport const formatterOption = { hour: 'numeric', minute: 'numeric' };\n\nexport const longFormatterOption = { hour: 'numeric', minute: 'numeric', second: 'numeric' };\n\nexport default function TimeFormatter({ children, date, long }: Props) {\n  return (\n    <FormattedTime value={parseDate(date)} {...(long ? longFormatterOption : formatterOption)}>\n      {children}\n    </FormattedTime>\n  );\n}\n","exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".maintenance-title{margin-bottom:40px;line-height:1.5;font-size:24px;font-weight:300;text-align:center}.maintenance-text{margin-bottom:16px;line-height:1.5;font-size:16px;font-weight:300}.maintenance-spinner{margin-top:40px;text-align:center}\", \"\"]);\n\n// exports\n","\nvar content = require(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/postcss-loader/lib/index.js??postcss!./styles.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/postcss-loader/lib/index.js??postcss!./styles.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/postcss-loader/lib/index.js??postcss!./styles.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","/*\n * SonarQube\n * Copyright (C) 2009-2018 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport * as classNames from 'classnames';\nimport Helmet from 'react-helmet';\nimport { getMigrationStatus, getSystemStatus, migrateDatabase } from '../../../api/system';\nimport DateFromNow from '../../../components/intl/DateFromNow';\nimport TimeFormatter from '../../../components/intl/TimeFormatter';\nimport { Button } from '../../../components/ui/buttons';\nimport { translate } from '../../../helpers/l10n';\nimport { getBaseUrl } from '../../../helpers/urls';\nimport '../styles.css';\n\ninterface Props {\n  // eslint-disable-next-line camelcase\n  location: { query: { return_to?: string } };\n  setup: boolean;\n}\n\ninterface State {\n  message?: string;\n  startedAt?: string;\n  state?: string;\n  status?: string;\n  wasStarting?: boolean;\n}\n\nexport default class App extends React.PureComponent<Props, State> {\n  interval?: number;\n  mounted = false;\n  state: State = {};\n\n  componentDidMount() {\n    this.mounted = true;\n    this.fetchStatus();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    if (this.interval) {\n      window.clearInterval(this.interval);\n    }\n  }\n\n  fetchStatus = () => {\n    const request = this.props.setup ? this.fetchMigrationState() : this.fetchSystemStatus();\n    request.catch(() => {\n      if (this.mounted) {\n        this.setState({\n          message: undefined,\n          startedAt: undefined,\n          state: undefined,\n          status: 'OFFLINE'\n        });\n      }\n    });\n  };\n\n  fetchSystemStatus = () => {\n    return getSystemStatus().then(({ status }) => {\n      if (this.mounted) {\n        this.setState({ status });\n\n        if (status === 'STARTING') {\n          this.setState({ wasStarting: true });\n          this.scheduleRefresh();\n        } else if (status === 'UP') {\n          if (this.state.wasStarting) {\n            this.loadPreviousPage();\n          }\n        } else {\n          this.scheduleRefresh();\n        }\n      }\n    });\n  };\n\n  fetchMigrationState = () => {\n    return getMigrationStatus().then(({ message, startedAt, state }) => {\n      if (this.mounted) {\n        this.setState({ message, startedAt, state });\n        if (state === 'MIGRATION_SUCCEEDED') {\n          this.loadPreviousPage();\n        } else if (state !== 'NO_MIGRATION') {\n          this.scheduleRefresh();\n        }\n      }\n    });\n  };\n\n  scheduleRefresh = () => {\n    this.interval = window.setTimeout(this.fetchStatus, 5000);\n  };\n\n  loadPreviousPage = () => {\n    setInterval(() => {\n      window.location.href = this.props.location.query['return_to'] || getBaseUrl() + '/';\n    }, 2500);\n  };\n\n  handleMigrateClick = () => {\n    migrateDatabase().then(\n      ({ message, startedAt, state }) => {\n        if (this.mounted) {\n          this.setState({ message, startedAt, state });\n        }\n      },\n      () => {}\n    );\n  };\n\n  render() {\n    const { state, status } = this.state;\n\n    return (\n      <>\n        <Helmet defaultTitle={translate('maintenance.page')} />\n        <div className=\"page-wrapper-simple\" id=\"bd\">\n          <div\n            className={classNames('page-simple', {\n              'panel-warning': state === 'MIGRATION_REQUIRED'\n            })}\n            id=\"nonav\">\n            {status === 'OFFLINE' && (\n              <>\n                <h1 className=\"maintenance-title text-danger\">\n                  {translate('maintenance.sonarqube_is_offline')}\n                </h1>\n                <p className=\"maintenance-text\">\n                  {translate('maintenance.sonarqube_is_offline.text')}\n                </p>\n                <p className=\"maintenance-text text-center\">\n                  <a href={getBaseUrl() + '/'}>{translate('maintenance.try_again')}</a>\n                </p>\n              </>\n            )}\n\n            {status === 'UP' && (\n              <>\n                <h1 className=\"maintenance-title\">{translate('maintenance.sonarqube_is_up')}</h1>\n                <p className=\"maintenance-text text-center\">\n                  {translate('maintenance.all_systems_opetational')}\n                </p>\n                <p className=\"maintenance-text text-center\">\n                  <a href={getBaseUrl() + '/'}>{translate('layout.home')}</a>\n                </p>\n              </>\n            )}\n\n            {status === 'STARTING' && (\n              <>\n                <h1 className=\"maintenance-title\">\n                  {translate('maintenance.sonarqube_is_starting')}\n                </h1>\n                <p className=\"maintenance-spinner\">\n                  <i className=\"spinner\" />\n                </p>\n              </>\n            )}\n\n            {status === 'DOWN' && (\n              <>\n                <h1 className=\"maintenance-title text-danger\">\n                  {translate('maintenance.sonarqube_is_down')}\n                </h1>\n                <p className=\"maintenance-text\">\n                  {translate('maintenance.sonarqube_is_down.text')}\n                </p>\n                <p className=\"maintenance-text text-center\">\n                  <a href={getBaseUrl() + '/'}>{translate('maintenance.try_again')}</a>\n                </p>\n              </>\n            )}\n\n            {(status === 'DB_MIGRATION_NEEDED' || status === 'DB_MIGRATION_RUNNING') && (\n              <>\n                <h1 className=\"maintenance-title\">\n                  {translate('maintenance.sonarqube_is_under_maintenance')}\n                </h1>\n                <p\n                  className=\"maintenance-text\"\n                  dangerouslySetInnerHTML={{\n                    __html: translate('maintenance.sonarqube_is_under_maintenance.1')\n                  }}\n                />\n                <p\n                  className=\"maintenance-text\"\n                  dangerouslySetInnerHTML={{\n                    __html: translate('maintenance.sonarqube_is_under_maintenance.2')\n                  }}\n                />\n              </>\n            )}\n\n            {state === 'NO_MIGRATION' && (\n              <>\n                <h1 className=\"maintenance-title\">\n                  {translate('maintenance.database_is_up_to_date')}\n                </h1>\n                <p className=\"maintenance-text text-center\">\n                  <a href={getBaseUrl() + '/'}>{translate('layout.home')}</a>\n                </p>\n              </>\n            )}\n\n            {state === 'MIGRATION_REQUIRED' && (\n              <>\n                <h1 className=\"maintenance-title\">{translate('maintenance.upgrade_database')}</h1>\n                <p className=\"maintenance-text\">{translate('maintenance.upgrade_database.1')}</p>\n                <p className=\"maintenance-text\">{translate('maintenance.upgrade_database.2')}</p>\n                <p className=\"maintenance-text\">{translate('maintenance.upgrade_database.3')}</p>\n                <div className=\"maintenance-spinner\">\n                  <Button id=\"start-migration\" onClick={this.handleMigrateClick}>\n                    {translate('maintenance.upgrade')}\n                  </Button>\n                </div>\n              </>\n            )}\n\n            {state === 'NOT_SUPPORTED' && (\n              <>\n                <h1 className=\"maintenance-title text-danger\">\n                  {translate('maintenance.migration_not_supported')}\n                </h1>\n                <p>{translate('maintenance.migration_not_supported.text')}</p>\n              </>\n            )}\n\n            {state === 'MIGRATION_RUNNING' && (\n              <>\n                <h1 className=\"maintenance-title\">{translate('maintenance.database_migration')}</h1>\n                {this.state.message && (\n                  <p className=\"maintenance-text text-center\">{this.state.message}</p>\n                )}\n                {this.state.startedAt && (\n                  <p className=\"maintenance-text text-center\">\n                    {translate('background_tasks.table.started')}{' '}\n                    <DateFromNow date={this.state.startedAt} />\n                    <br />\n                    <small className=\"text-muted\">\n                      <TimeFormatter date={this.state.startedAt} long={true} />\n                    </small>\n                  </p>\n                )}\n                <p className=\"maintenance-spinner\">\n                  <i className=\"spinner\" />\n                </p>\n              </>\n            )}\n\n            {state === 'MIGRATION_SUCCEEDED' && (\n              <>\n                <h1 className=\"maintenance-title text-success\">\n                  {translate('maintenance.database_is_up_to_date')}\n                </h1>\n                <p className=\"maintenance-text text-center\">\n                  <a href={getBaseUrl() + '/'}>{translate('layout.home')}</a>\n                </p>\n              </>\n            )}\n\n            {state === 'MIGRATION_FAILED' && (\n              <>\n                <h1 className=\"maintenance-title text-danger\">\n                  {translate('maintenance.upgrade_failed')}\n                </h1>\n                <p className=\"maintenance-text\">{translate('maintenance.upgrade_failed.text')}</p>\n              </>\n            )}\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n"],"sourceRoot":""}